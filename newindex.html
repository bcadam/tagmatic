<html>

<head>
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-MfvZlkHCEqatNoGiOXveE8FIwMzZg4W85qfrfIFBfYc= sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha256-Sk3nkD6mLTMOF0EOpNtsIry+s1CsaqQC1rVLTAy+0yc= sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>
</head>

<body id="target" class='col-xs-12'>
    <div class="col-xs-6 well" id="length">
    </div>
    <div class="col-xs-6 well" id="followers">
    </div>
    <div class="col-xs-6 well" id="words">
    </div>
    <div class="col-xs-6 well" id="locations">
    </div>
    <div class='col-xs-12'>
        <div class="col-xs-4 well" id="happytweets">
        </div>
        <div class="col-xs-4 well" id="noiseTweets">
        </div>
        <div class="col-xs-4 well" id="sadTweets">
        </div>
    </div>
</body>
<script>

var dateString = 'Wed Oct 28 14:41:43 +0000 2015';
console.log(dateString);

function combineBasedOnSimilarityOfString(words, distanceForSame) {
    var arrayOfMatches = [];
    for (var i = 0; i < words.length; i++) {
        for (var j = i + 1; j < words.length; j++) {
            //var distance = JaroWinklerDistance()
            var distance = JaroWinklerDistance(words[i][0], words[j][0]);
            if (distance > distanceForSame) {
                words[i][1] = words[i][1] + words[j][1];
                words.splice(j, 0);
            }
        }
    }
    return words;
}

function distance(s1, s2) {
    if (typeof(s1) != "string" || typeof(s2) != "string") return 0;
    if (s1.length == 0 || s2.length == 0) 
        return 0;
    s1 = s1.toLowerCase(), s2 = s2.toLowerCase();
    var matchWindow = (Math.floor(Math.max(s1.length, s2.length) / 2.0)) - 1;
    var matches1 = new Array(s1.length);
    var matches2 = new Array(s2.length);
    var m = 0; // number of matches
    var t = 0; // number of transpositions

    //debug helpers
    //console.log("s1: " + s1 + "; s2: " + s2);
    //console.log(" - matchWindow: " + matchWindow);

    // find matches
    for (var i = 0; i < s1.length; i++) {
    var matched = false;

    // check for an exact match
    if (s1[i] ==  s2[i]) {
        matches1[i] = matches2[i] = matched = true;
        m++
    }

    // check the "match window"
    else {
            // this for loop is a little brutal
            for (k = (i <= matchWindow) ? 0 : i - matchWindow;
                (k <= i + matchWindow) && k < s2.length && !matched;
            k++) {
                    if (s1[i] == s2[k]) {
                        if(!matches1[i] && !matches2[k]) {
                                m++;
                    }

                    matches1[i] = matches2[k] = matched = true;
                }
            }
    }
    }

    if(m == 0)
        return 0.0;

    // count transpositions
    var k = 0;

    for(var i = 0; i < s1.length; i++) {
        if(matches1[k]) {
            while(!matches2[k] && k < matches2.length)
                k++;
            if(s1[i] != s2[k] &&  k < matches2.length)  {
                t++;
            }

            k++;
        }
    }
    
    //debug helpers:
    //console.log(" - matches: " + m);
    //console.log(" - transpositions: " + t);
    t = t / 2.0;
    return (m / s1.length + m / s2.length + (m - t) / m) / 3;
}

// http://en.wikipedia.org/wiki/Jaro%E2%80%93Winkler_distance
// s1 is the first string to compare
// s2 is the second string to compare
// dj is the Jaro Distance (if you've already computed it), leave blank and the method handles it
function JaroWinklerDistance(s1, s2, dj) {
        if (s1 == s2) {
                return 1 
        }
        else {
            var jaro;
            (typeof(dj) == 'undefined')? jaro = distance(s1,s2) : jaro = dj;
            var p = 0.1; //
            var l = 0 // length of the matching prefix
            while(s1[l] == s2[l] && l < 4)
                l++;
            
            return jaro + l * p * (1 - jaro);
        }
}

var searchValue = "London";
var host = "http://onemonarch.herokuapp.com";
var url = host + "/api/data/" + searchValue + "/100";
var xmlhttp;
var response;
xmlhttp = new XMLHttpRequest();
xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        console.log(xmlhttp.response.length);
        response = xmlhttp.response;
        document.getElementById("length").innerHTML = "We found " + response.length + " tweets!";

        //document.getElementById("followers").innerHTML = response.followers;

        for (var i = 0; i < response.followers.length; i++) {
            var node = document.createElement('div');
            var textnode = document.createTextNode(response.followers[i]);
            node.appendChild(textnode);
            document.getElementById("followers").appendChild(node);
        };

        //console.log(response.words);
        var wordLength = response.words.length;
        response.words = combineBasedOnSimilarityOfString(response.words,.92);
        if (response.words.length > 10) {
            wordLength = 10;
        }
        for (var i = 0; i < wordLength; i++) {
            var node = document.createElement("div"); // Create a <li> node
            var textnode = document.createTextNode(response.words[i]); // Create a text node
            node.appendChild(textnode); // Append the text to <li>
            document.getElementById("words").appendChild(node);
        };

        var locationLength = response.locations.length;
        if (response.locations.length > 10) {
            locationLength = 10;
        }
        for (var i = 0; i < locationLength; i++) {
            var node = document.createElement("div"); // Create a <li> node
            var textnode = document.createTextNode(response.locations[i]); // Create a text node
            node.appendChild(textnode); // Append the text to <li>
            document.getElementById("locations").appendChild(node);
        };

        for (var i = 0; i < response.sentiment.happytweets.length; i++) {
            var node = document.createElement("div"); // Create a <li> node
            var textnode = document.createTextNode(response.sentiment.happytweets[i].text); // Create a text node
            node.appendChild(textnode); // Append the text to <li>
            document.getElementById("happytweets").appendChild(node);
        };

        for (var i = 0; i < response.sentiment.noiseTweets.length; i++) {
            var node = document.createElement("div"); // Create a <li> node
            var textnode = document.createTextNode(response.sentiment.noiseTweets[i].text); // Create a text node
            node.appendChild(textnode); // Append the text to <li>
            document.getElementById("noiseTweets").appendChild(node);
        };

        for (var i = 0; i < response.sentiment.sadTweets.length; i++) {
            var node = document.createElement("div"); // Create a <li> node
            var textnode = document.createTextNode(response.sentiment.sadTweets[i].text); // Create a text node
            node.appendChild(textnode); // Append the text to <li>
            document.getElementById("sadTweets").appendChild(node);
        };


    }
}
xmlhttp.open("GET", url, true);
xmlhttp.responseType = 'json';
xmlhttp.send();

// var searchValue = "kabbage";
// var host = "https://onemonarch.herokuapp.com";
// var url = host + "/api/geotagged/" + searchValue;
// var xmlhttp;
// var response;
// xmlhttp = new XMLHttpRequest();
// xmlhttp.onreadystatechange = function() {
//     if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
//         console.log(xmlhttp.response);
//         response = xmlhttp.response;
//     }
// }
// xmlhttp.open("GET", url, true);
// xmlhttp.responseType = 'json';
// xmlhttp.send();
</script>

</html>
